spring:
  application:
    name: my-jira

  datasource:
      url: jdbc:postgresql://localhost:5432/myjira
      username: ${DB_USER:postgres}
      password: ${DB_PASSWORD:1234}
      driver-class-name: org.postgresql.Driver

  jpa:
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        # dialect: org.hibernate.dialect.PostgreSQLDialect
        "[format_sql]": true
        jdbc:
          lob:
            "[non_contextual_creation]": true
    show-sql: false

  # flyway:
  #   enabled: true
  #   locations: classpath:db/migration
  #   baseline-on-migrate: true
  #   validate-on-migrate: true
  #   baseline-version: 1
  #   # Важно: не создавать заново существующие таблицы
  #   placeholders:
  #     existing-schema: true

  security:
    oauth2:
      client:
        registration:
          # Google - будет отключен если нет переменных окружения
          google:
            client-id: ${GOOGLE_CLIENT_ID:disabled}
            client-secret: ${GOOGLE_CLIENT_SECRET:disabled}
            scope:
              - email
              - profile
          
          # GitHub - будет отключен если нет переменных окружения
          github:
            client-id: ${GITHUB_CLIENT_ID:disabled}
            client-secret: ${GITHUB_CLIENT_SECRET:disabled}
            scope:
              - user:email
              - read:user
          
          # GitLab - будет отключен если нет переменных окружения
          gitlab:
            client-id: ${GITLAB_CLIENT_ID:disabled}
            client-secret: ${GITLAB_CLIENT_SECRET:disabled}
            scope:
              - read_user
              - email
            authorization-grant-type: authorization_code
            redirect-uri: "{baseUrl}/login/oauth2/code/{registrationId}"
            client-name: GitLab
          
          # Yandex - будет отключен если нет переменных окружения
          yandex:
            client-id: ${YANDEX_CLIENT_ID:disabled}
            client-secret: ${YANDEX_CLIENT_SECRET:disabled}
            scope:
              - login:email
              - login:info
            authorization-grant-type: authorization_code
            redirect-uri: "{baseUrl}/login/oauth2/code/{registrationId}"
            client-name: Yandex
          
          # Mail.ru - будет отключен если нет переменных окружения
          mailru:
            client-id: ${MAILRU_CLIENT_ID:disabled}
            client-secret: ${MAILRU_CLIENT_SECRET:disabled}
            scope:
              - userinfo
            authorization-grant-type: authorization_code
            redirect-uri: "{baseUrl}/login/oauth2/code/{registrationId}"
            client-name: Mail.ru

        provider:
          # GitLab configuration
          gitlab:
            authorization-uri: https://gitlab.com/oauth/authorize
            token-uri: https://gitlab.com/oauth/token
            user-info-uri: https://gitlab.com/api/v4/user
            user-name-attribute: name
            
          # Yandex configuration  
          yandex:
            authorization-uri: https://oauth.yandex.ru/authorize
            token-uri: https://oauth.yandex.ru/token
            user-info-uri: https://login.yandex.ru/info
            user-name-attribute: login
            
          # Mail.ru configuration
          mailru:
            authorization-uri: https://oauth.mail.ru/login
            token-uri: https://oauth.mail.ru/token
            user-info-uri: https://oauth.mail.ru/userinfo
            user-name-attribute: email

  thymeleaf:
    cache: false
    prefix: classpath:/templates/
    suffix: .html

  devtools:
    restart:
      enabled: true
      poll-interval: 1000
      quiet-period: 400
      # Пока оставляем исключения, можно будет настроить позже
      exclude: static/**,public/**,templates/**

  # datasource:
  #   url: jdbc:h2:mem:testdb
  #   driver-class-name: org.h2.Driver
  #   username: sa
  #   password: 
  # jpa:
  #   database-platform: org.hibernate.dialect.H2Dialect
  #   hibernate:
  #     ddl-auto: create-drop
  #   show-sql: true
  # h2:
  #   console:
  #     enabled: true

server:
  port: 22080
  servlet:
    context-path: /api

logging:
  level:
    '[ru.mymsoft.my_jira]': INFO
    '[org.springframework.security]': INFO
    '[org.hibernate]': INFO
    '[org.flywaydb]': INFO
    # Добавляем логирование для OAuth2
    '[org.springframework.security.oauth2]': INFO

app:
  jwt:
    secret: ${JWT_SECRET:myJiraSecretKeyForJWTGenerationWithEnoughLengthForSecurity123!}
    expiration: 86400000
  cors:
    allowed-origins: http://localhost:3000,http://localhost:22080